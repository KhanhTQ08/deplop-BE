<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Laralink">
        <link rel="icon" href="/slider_1-main/image/ok.png" type="image/png">
    
    <!-- Site Title -->
    <title>Hóa đơn - For The Love</title>
    <link rel="stylesheet" href="/slider_1-main/css/invoice.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
</head>

<body>
<div class="tm_container">
    <div class="tm_invoice_wrap">
        <div class="tm_invoice tm_style2 tm_type1 tm_accent_border" id="tm_download_section">
            <div class="tm_invoice_in">
                <div class="tm_invoice_head tm_mb20 tm_m0_md">
                    <div class="tm_invoice_left">
                        <div class="tm_logo">
                            <span style="font-size: 30px;font-weight: 800;color: aliceblue;">HÓA ĐƠN</span>
                        </div>
                    </div>
                    <div class="tm_invoice_right" th:if="${cinemaShowtime != null}">
                        <div class="tm_grid_row tm_col_3">
                            <div class="tm_text_center">
                                <p class="tm_accent_color tm_mb0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"
                                         fill="currentColor">
                                        <path
                                                d="M424 80H88a56.06 56.06 0 00-56 56v240a56.06 56.06 0 0056 56h336a56.06 56.06 0 0056-56V136a56.06 56.06 0 00-56-56zm-14.18 92.63l-144 112a16 16 0 01-19.64 0l-144-112a16 16 0 1119.64-25.26L256 251.73l134.18-104.36a16 16 0 0119.64 25.26z" />
                                    </svg>
                                </p>
                                <span th:text="${cinemaShowtime.email}">Email</span>
                            </div>
                            <div class="tm_text_center">
                                <p class="tm_accent_color tm_mb0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"
                                         fill="currentColor">
                                        <path
                                                d="M391 480c-19.52 0-46.94-7.06-88-30-49.93-28-88.55-53.85-138.21-103.38C116.91 298.77 93.61 267.79 61 208.45c-36.84-67-30.56-102.12-23.54-117.13C45.82 73.38 58.16 62.65 74.11 52a176.3 176.3 0 0128.64-15.2c1-.43 1.93-.84 2.76-1.21 4.95-2.23 12.45-5.6 21.95-2 6.34 2.38 12 7.25 20.86 16 18.17 17.92 43 57.83 52.16 77.43 6.15 13.21 10.22 21.93 10.23 31.71 0 11.45-5.76 20.28-12.75 29.81-1.31 1.79-2.61 3.5-3.87 5.16-7.61 10-9.28 12.89-8.18 18.05 2.23 10.37 18.86 41.24 46.19 68.51s57.31 42.85 67.72 45.07c5.38 1.15 8.33-.59 18.65-8.47 1.48-1.13 3-2.3 4.59-3.47 10.66-7.93 19.08-13.54 30.26-13.54h.06c9.73 0 18.06 4.22 31.86 11.18 18 9.08 59.11 33.59 77.14 51.78 8.77 8.84 13.66 14.48 16.05 20.81 3.6 9.53.21 17-2 22-.37.83-.78 1.74-1.21 2.75a176.49 176.49 0 01-15.29 28.58c-10.63 15.9-21.4 28.21-39.38 36.58A67.42 67.42 0 01391 480z" />
                                    </svg>
                                </p>
                                <span th:text="${cinemaShowtime.phoneNumber}">Số Điện Thoại</span>
                            </div>
                            <div class="tm_text_center">
                                <p class="tm_accent_color tm_mb0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"
                                         fill="currentColor">
                                        <circle cx="256" cy="192" r="32" />
                                        <path
                                                d="M256 32c-88.22 0-160 68.65-160 153 0 40.17 18.31 93.59 54.42 158.78 29 52.34 62.55 99.67 80 123.22a31.75 31.75 0 0051.22 0c17.42-23.55 51-70.88 80-123.22C397.69 278.61 416 225.19 416 185c0-84.35-71.78-153-160-153zm0 224a64 64 0 1164-64 64.07 64.07 0 01-64 64z" />
                                    </svg>
                                </p>
                                <span th:text="${cinemaShowtime.address}">Địa Chỉ</span>
                            </div>
                        </div>
                    </div>
                    <div class="tm_shape_bg tm_accent_bg"></div>
                </div>
                <div class="tm_invoice_info tm_mb10">
                    <div class="tm_invoice_info_left">
                        <p class="tm_mb2"><b>Thông tin phim</b></p>
                        <p>
                            <b class="tm_f16 tm_primary_color"><strong>Tên phim:</strong> <strong th:text="${movieName}"></strong></b> <br>
                            <span>Phòng chiếu:</span> <span th:text="${roomName}"></span><br>
                            <span>Thời gian chiếu:</span> <span th:text="${startTime} + ' - ' + ${endTime}"></span> <br>
                            <span>Ngày chiếu:</span> <span th:text="${#temporals.format(showtimeDate, 'dd-MM-yyyy')}"></span>
                        </p>
                    </div>
                    <div class="tm_invoice_info_right text-end">
                        <p class="tm_mb2"><b>Khách hàng</b></p>
                        <p>
                            <b class="tm_f16 tm_primary_color">
                                <strong th:text="${session.acc != null ? session.acc.fullName : 'Tên khách hàng'}">Truong Hoang Quan</strong>
                            </b> <br>
                            <span th:text="${session.acc != null ? session.acc.email : 'email@default.com'}">quandeptrai1208@gmail.com</span><br>
                            <span th:text="${session.acc != null ? session.acc.phoneNumber : '+48 123 456 789'}">+48 123 456 789</span>
                        </p>
                    </div>
                </div>
                <div class="tm_table tm_style1">
                    <div class="tm_round_border">
                        <div class=" custom-table-responsive">
                            <div class="table-responsive custom-table-responsive">
                                <table class="table table-striped table-hover mb-0">
                                    <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Tên ghế</th>
                                        <th>Loại ghế</th>
                                        <th>Đơn giá</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <th:block th:each="seat, iterStat : ${selectedSeats}">
                                        <tr th:if="${seat.seatPrice != null && seat.seatPrice > 0}">
                                            <th scope="row" th:text="${iterStat.index + 1}"></th>
                                            <td th:text="${seat.seatName}" style="color: #e4434b; font-weight: 400"></td>
                                            <td th:text="${seat.seatStatus}"></td>
                                            <td th:text="${seat.seatPrice}"></td>
                                        </tr>
                                    </th:block>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="tm_round_border mt-5 mb-3" th:if="${products != null and !products.isEmpty()}">
                        <div class="tm_table_responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Số lượng</th>
                                    <th>Đơn giá</th>
                                    <th>Thành tiền</th>
                                </tr>
                                </thead>
                                <tbody>
                                <th:block th:each="product, iterStat : ${products}">
                                    <tr>
                                        <th scope="row" th:text="${iterStat.index + 1}"></th>
                                        <td th:text="${product.productEntity.productName}" style="color: #e4434b; font-weight: 400"></td>
                                        <td th:text="${product.quantity}"></td>
                                        <td th:text="${product.productEntity.productPrice}"></td>
                                        <td th:text="${product.productEntity.productPrice * product.quantity}"></td>
                                    </tr>
                                </th:block>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tm_invoice_footer tm_mb15 tm_m0_md">
                        <div class="tm_left_footer" th:if="${cinemaShowtime != null}">
                            <div class="tm_mb10 tm_m0_md"></div>
                            <p class="tm_mb0">
                                <b class="tm_primary_color"> <span th:text="${cinemaShowtime.cinemaName}">Email</span></b> <br>
                                <span th:text="'Adress: '+${cinemaShowtime.address}">Email</span> <br>
                                <span th:text="'Email: '+${cinemaShowtime.email}">Email</span><br>
                                <span th:text="'Phone: ' + ${cinemaShowtime.phoneNumber}">Email</span><br>
                                <img src="/vnpay-logo.png" class="logoVnPay mt-3"/></p>
                            <style>
                                .logoVnPay{
                                    width: 200px;
                                }
                            </style>
                        </div>
                        <div class="tm_right_footer">
                            <table class="tm_mb15 tm_m0_md">
                                <tbody>
                                <tr>
                                    <td><strong>Tổng giá ghế:</strong></td>
                                    <td class="right total-seat-price" th:text="${totalSeatPrice}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Tổng giá sản phẩm:</strong></td>
                                    <td class="right total-product-price" th:text="${totalProductPrice}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Số tiền cần thanh toán:</strong></td>
                                    <td class="right total-payment-price tm_bold" th:text="${totalPayment}"></td>
                                </tr>
                                </tbody>
                            </table>
                            <!-- Form thanh toán -->
                            <form action="/submitOrder" method="post" class="tm_text_right" id="orderForm">
                                <input type="number" id="amount" name="amount" value="1000" hidden>
                                <input type="text" id="orderInfo" name="orderInfo" value="Đơn hàng mới nhất" hidden>

                                <div style="margin-bottom: 10px;">
                                    <input type="checkbox" id="termsCheckbox" name="termsCheckbox" onchange="toggleButton()">
                                    <label for="termsCheckbox">
                                        Tôi đồng ý với <a href="#" id="termsLink">điều khoản và điều kiện</a>.
                                    </label>
                                </div>

                                <button type="submit" id="submitButton" class="float-right" disabled>
                                    <i class="bi bi-currency-dollar"></i> Thanh toán
                                </button>
                            </form>

                            <!-- Modal Điều Khoản -->
                            <div id="termsModal" class="modal">
                                <div class="modal-content">
                                    <span class="close" id="closeModal">&times;</span>
                                    <h2>Điều Khoản và Điều Kiện</h2>
                                    <p>Bạn cần đọc kỹ các điều khoản dưới đây trước khi đồng ý:</p>
                                    <ol>
                                        <li>Vé đã mua không thể hoàn tiền hoặc đổi sang phim khác.</li>
                                        <li>Người xem dưới 18 tuổi phải có người lớn đi kèm cho các phim có giới hạn độ tuổi.</li>
                                        <li>Vui lòng có mặt tại rạp ít nhất 15 phút trước giờ chiếu.</li>
                                        <li>Cấm quay phim, chụp ảnh trong rạp chiếu phim.</li>
                                        <li>Thông tin cá nhân của bạn sẽ được bảo mật theo chính sách bảo mật của chúng tôi.</li>
                                    </ol>
                                    <button id="acceptTerms">Đồng ý</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tm_bottom_invoice">
                    <div class="tm_bottom_invoice_left">
                        <p class="tm_m0 tm_f18 tm_accent_color tm_mb5">Cảm ơn quý khách đã đặt vé với chúng tôi.</p>
                        <p class="tm_primary_color tm_f12 tm_m0 tm_bold">Điều khoản & Điều kiện</p>
                        <p class="tm_m0 tm_f12">Hóa đơn được tạo trên hệ thống và có giá trị mà không cần chữ ký hoặc con dấu.</p>
                    </div>
                    <div class="tm_bottom_invoice_right tm_mobile_hide">
                        <div class="tm_logo"><img src="http://localhost:8080/slider_1-main/image/ok.png" alt="Logo"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tm_invoice_btns tm_hide_print">
            <a href="javascript:window.print()" class="tm_invoice_btn tm_color1">
          <span class="tm_btn_icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
              <path
                      d="M384 368h24a40.12 40.12 0 0040-40V168a40.12 40.12 0 00-40-40H104a40.12 40.12 0 00-40 40v160a40.12 40.12 0 0040 40h24"
                      fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
              <rect x="128" y="240" width="256" height="208" rx="24.32" ry="24.32" fill="none" stroke="currentColor"
                    stroke-linejoin="round" stroke-width="32" />
              <path d="M384 128v-24a40.12 40.12 0 00-40-40H168a40.12 40.12 0 00-40 40v24" fill="none"
                    stroke="currentColor" stroke-linejoin="round" stroke-width="32" />
              <circle cx="392" cy="184" r="24" fill='currentColor' />
            </svg>
          </span>
                <span class="tm_btn_text">Print</span>
            </a>
            <button id="tm_back_btn" class="tm_invoice_btn tm_color2" onclick="history.back()">
                <span class="tm_btn_icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                        <path
                                d="M328 112L184 256l144 144M184 256h344"
                                fill="none" stroke="currentColor" stroke-linecap="round"
                                stroke-linejoin="round" stroke-width="32" />
                    </svg>
                </span>
                <span class="tm_btn_text">Trở về</span>
            </button>

        </div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(amount).replace('₫', '').trim() + ' VND';
        document.querySelectorAll('tbody tr').forEach(row => {
            const cells = [row.querySelector('td:nth-child(4)'), row.querySelector('td:nth-child(5)')];
            cells.forEach(cell => {
                if (cell) cell.textContent = formatCurrency(parseFloat(cell.textContent));
            });
        });
        ['total-seat-price', 'total-product-price', 'total-payment-price'].forEach(className => {
            const el = document.querySelector(`.${className}`);
            if (el) el.textContent = formatCurrency(parseFloat(el.textContent));
        });
    });
        // Hiển thị modal khi trang vừa tải
        window.onload = function() {
        document.getElementById('termsModal').style.display = 'block';
    };

        // Đóng modal khi nhấn vào nút 'close'
        document.getElementById('closeModal').onclick = function() {
        document.getElementById('termsModal').style.display = 'none';
    };

        // Đóng modal khi nhấn bên ngoài modal
        window.onclick = function(event) {
        if (event.target == document.getElementById('termsModal')) {
        document.getElementById('termsModal').style.display = 'none';
    }
    };

        // Khi nhấn 'Đồng ý', đóng modal và kích hoạt checkbox
        document.getElementById('acceptTerms').onclick = function() {
        document.getElementById('termsCheckbox').checked = true;
        toggleButton(); // Cập nhật trạng thái nút thanh toán
        document.getElementById('termsModal').style.display = 'none';
    };

        // Mở modal khi nhấn vào liên kết "điều khoản và điều kiện"
        document.getElementById('termsLink').onclick = function(event) {
        event.preventDefault();
        document.getElementById('termsModal').style.display = 'block';
    };

        // Đóng modal khi nhấn vào nút 'close'
        document.getElementById('closeModal').onclick = function() {
        document.getElementById('termsModal').style.display = 'none';
    };

        // Đóng modal khi nhấn bên ngoài modal
        window.onclick = function(event) {
        if (event.target == document.getElementById('termsModal')) {
        document.getElementById('termsModal').style.display = 'none';
    }
    };

        // Khi nhấn 'Đồng ý', đóng modal và kích hoạt checkbox
        document.getElementById('acceptTerms').onclick = function() {
        document.getElementById('termsCheckbox').checked = true;
        toggleButton(); // Cập nhật trạng thái nút thanh toán
        document.getElementById('termsModal').style.display = 'none';
    };

        // Thay đổi trạng thái nút thanh toán khi checkbox được chọn hoặc bỏ chọn
        function toggleButton() {
        var checkbox = document.getElementById("termsCheckbox");
        var submitButton = document.getElementById("submitButton");

        if (checkbox.checked) {
        submitButton.disabled = false;
        submitButton.classList.add("enabled");
    } else {
        submitButton.disabled = true;
        submitButton.classList.remove("enabled");
    }
    }

        // Kiểm tra khi gửi form
        document.getElementById("orderForm").onsubmit = function(event) {
        var checkbox = document.getElementById("termsCheckbox");
        var submitButton = document.getElementById("submitButton");
        var amount = document.getElementById("amount").value;

        if (!checkbox.checked || submitButton.disabled || amount <= 0) {
        alert("Bạn cần đồng ý với điều khoản và kiểm tra số tiền thanh toán.");
        event.preventDefault();
    }
    };
</script>

</body>

</html>