<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Danh s√°ch h√≥a ƒë∆°n - For The Love</title>
    <link rel="icon" href="/slider_1-main/image/ok.png" type="image/png">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/slider_1-main/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css"/>

    <style>
        table.table th, table.table td {
            text-align: center;
            vertical-align: middle;
        }

        body {
            color: black;
        }

        .btnAction:hover {
            border: none;
        }

        #backButton {
            position: absolute;
            display: block;
            justify-content: flex-start; /* CƒÉn n√∫t v·ªÅ ph√≠a tr√°i */
            color: #100f0f;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }


        #backButton i {
            font-size: 30px;
        }

        #backButton:hover {
            transform: scale(1.1); /* N√∫t to ra khi hover */
        }

        #backButton::after {
            content: "Tr·ªü v·ªÅ"; /* Ch√∫ th√≠ch */
            position: absolute;
            top: 50%; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc so v·ªõi n√∫t */
            right: 120%; /* Hi·ªÉn th·ªã b√™n tr√°i n√∫t */
            transform: translateY(-50%); /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
            background-color: white; /* N·ªÅn tr·∫Øng */
            color: black; /* M√†u ch·ªØ ƒëen */
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* ƒê·ªï b√≥ng cho ch√∫ th√≠ch */
            opacity: 0;
            pointer-events: none;
            white-space: nowrap; /* Gi·ªØ ch·ªØ n·∫±m ngang */
            transition: opacity 0.3s ease;
        }

        #backButton:hover::after {
            opacity: 1; /* Hi·ªán ch√∫ th√≠ch khi hover */
        }

    </style>
</head>


<body>
<div class="container mt-4">
    <div class="mb-4">
        <!-- Back to Home Button (cƒÉn tr√°i) -->
        <a th:href="@{/index}" id="backButton">
            <i class="bi bi-chevron-double-left"></i>
        </a>
        <!-- Invoice List Title (cƒÉn gi·ªØa) -->
        <h1 class="mb-0 text-center">üìã Danh S√°ch H√≥a ƒê∆°n</h1>
    </div>

    <table id="myTable" class="table-striped table-bordered">
        <thead>
        <tr>
            <th class="text-center text-black">STT</th>
            <th class="text-center text-black">T√™n phim</th>
            <th class="text-center text-black">Th·ªùi gian chi·∫øu</th>
            <th class="text-center text-black">Ph√≤ng chi·∫øu</th>
            <th class="text-center text-black">Ng√†y thanh to√°n</th>
            <th class="text-center text-black">T·ªïng ti·ªÅn</th>
            <th class="text-center text-black">Tr·∫°ng th√°i</th>
            <th class="text-center text-black">Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="invoice, iterStat : ${invoices}">
            <td class="text-center text-black font-weight-normal" th:text="${iterStat.index + 1}"></td>
            <td class="text-center text-black font-weight-normal" th:text="${invoice.showtime.movie.movieName}"></td>
            <td class="text-center text-black font-weight-normal" th:text="${invoice.showtime.startTime} + ' - ' + ${invoice.showtime.endTime}"></td>
            <td class="text-center text-black font-weight-normal" th:text="${invoice.showtime.room.roomName}"></td>
            <td class="text-center text-black font-weight-normal" th:text="${invoice.bookingDate} + ', ' + ${invoice.bookingTime}"></td>
            <td class="text-center text-black font-weight-normal amount" th:text="${invoice.totalAmount}"></td>
            <td class="text-center text-black font-weight-normal" th:text="${invoice.status}"></td>
            <td>
                <button class="btn btnAction" style="background-color: #ff4971; color: #ffff" data-toggle="modal"
                        th:data-target="'#ticketsModal-' + ${invoice.invoiceId}">Xem Th√™m
                </button>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:each="invoice : ${invoices}">
        <div class="modal fade" th:id="'ticketsModal-' + ${invoice.invoiceId}" tabindex="-1" role="dialog"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable" style="max-width: 80%;" role="document">
                <div class="modal-content">
                    <div class="modal-header " style="background-color: #ff4971">
                        <h5 class="modal-title"
                            style="color: #fff">Th√¥ng tin h√≥a ƒë∆°n</h5>
                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-4">
                            <div class="col-md-4 text-center">
                                <h5 style="color: black">QR Code nh·∫≠n v√©</h5>
                                <img th:if="${qrCodeMap[invoice.invoiceId] != null}"
                                     th:src="'data:image/png;base64,' + ${qrCodeMap[invoice.invoiceId]}"
                                     alt="QR Code" style="width:200px; height:200px;">
                                <div class="text-center mt-2" style="color: black">
                                    <p style="font-weight: 400;"><em>L∆∞u √Ω: Qu√Ω kh√°ch vui l√≤ng cung c·∫•p m√£ n√†y cho nh√¢n vi√™n ƒë·ªÉ ho√†n t·∫•t th·ªß t·ª•c nh·∫≠n v√©.</em>
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <h5 style="color: black">Danh s√°ch v√©</h5>
                                <table class="table table-bordered table-striped">
                                    <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>T√™n gh·∫ø</th>
                                        <th>Ph√≤ng</th>
                                        <th>T√™n r·∫°p</th>
                                        <th>ƒê·ªãa ch·ªâ</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="ticket, ticketStat : ${invoice.tickets}">
                                        <td th:text="${ticketStat.index + 1}"></td>
                                        <td th:text="${ticket.seat.seatName}"></td>
                                        <td th:text="${ticket.seat.room.roomName}"></td>
                                        <td th:text="${ticket.invoice.showtime.cinemaInformation.cinemaName}"></td>
                                        <td th:text="${ticket.invoice.showtime.cinemaInformation.address}"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>


                        <!-- Hi·ªÉn th·ªã b·∫£ng n·∫øu c√≥ s·∫£n ph·∫©m -->
                        <div th:if="${invoice.invoiceDetails != null and !invoice.invoiceDetails.isEmpty()}">
                            <h5 style="color: black">Danh s√°ch s·∫£n ph·∫©m</h5>
                            <table class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th>S·ªë l∆∞·ª£ng</th>
                                    <th>ƒê∆°n gi√°</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="invoiceDetail, detailStat : ${invoice.invoiceDetails}">
                                    <td th:text="${detailStat.index + 1}"></td>
                                    <td th:text="${invoiceDetail.product.productName}"></td>
                                    <td th:text="${invoiceDetail.quantity}"></td>
                                    <td class="amount" th:text="${invoiceDetail.price}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h5 style="color: black">Th√¥ng Tin Phim</h5>
                        <table class="table table-bordered table-striped">
                            <thead>
                            <tr>
                                <th>STT</th>
                                <th>T√™n phim</th>
                                <th>Th·ªùi l∆∞·ª£ng</th>
                                <th>ƒê·∫°o di·ªÖn</th>
                                <th>Th·ªÉ lo·∫°i</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td th:text="'1'"></td>
                                <td th:text="${invoice.showtime.movie.movieName}"></td>
                                <td th:text="${invoice.showtime.movie.duration + ' ph√∫t'}"></td>
                                <td th:text="${invoice.showtime.movie.director}"></td>
                                <td th:text="${invoice.showtime.movie.genre}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const amountElements = document.querySelectorAll('.amount');
        amountElements.forEach(el => {
            const amount = parseInt(el.innerText);
            el.innerText = formatCurrencyVND(amount);
        });
    });

    function formatCurrencyVND(amount) {
        return new Intl.NumberFormat('vi-VN', {style: 'currency', currency: 'VND'}).format(amount).replace('‚Ç´', 'VNƒê');
    }

    $(document).ready(function () {
        $('#myTable').DataTable({
            "language": {
                "sSearch": "T√¨m ki·∫øm:", // "Search"
                "sLengthMenu": "Hi·ªÉn th·ªã _MENU_ m·ª•c", // "Show _MENU_ entries"
                "sInfo": "ƒêang hi·ªÉn th·ªã t·ª´ _START_ ƒë·∫øn _END_ trong t·ªïng s·ªë _TOTAL_ m·ª•c", // "Showing _START_ to _END_ of _TOTAL_ entries"
                "sInfoEmpty": "Kh√¥ng c√≥ m·ª•c n√†o", // "Showing 0 to 0 of 0 entries"
                "sInfoFiltered": "(l·ªçc t·ª´ _MAX_ m·ª•c)",
                "sEmptyTable": "Kh√¥ng c√≥ d·ªØ li·ªáu", // Th√¥ng b√°o n·∫øu b·∫£ng kh√¥ng c√≥ d·ªØ li·ªáu
                "sZeroRecords": "Kh√¥ng t√¨m th·∫•y",  // Th√¥ng b√°o t√¨m ki·∫øm kh√¥ng c√≥ k·∫øt qu·∫£
                "sInfoPostFix": "", // Kh√¥ng thay ƒë·ªïi
                "oPaginate": {
                    "sFirst": "ƒê·∫ßu ti√™n", // "First"
                    "sPrevious": "Tr∆∞·ªõc", // "Previous"
                    "sNext": "Ti·∫øp theo", // "Next"
                    "sLast": "Cu·ªëi c√πng" // "Last"
                },
                "oAria": {
                    "sSortAscending": ": K√≠ch ho·∫°t ƒë·ªÉ s·∫Øp x·∫øp theo th·ª© t·ª± tƒÉng d·∫ßn", // ": activate to sort column ascending"
                    "sSortDescending": ": K√≠ch ho·∫°t ƒë·ªÉ s·∫Øp x·∫øp theo th·ª© t·ª± gi·∫£m d·∫ßn" // ": activate to sort column descending"
                }
            }
        });
    });

</script>

<script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
</body>
</html>
